<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HotList 30</title>
  <style>
    /* ===== ãƒªã‚»ãƒƒãƒˆ & ãƒ™ãƒ¼ã‚¹ ===== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary: #c084fc;
      --primary-dark: #a855f7;
      --danger: #ff5252;
      --success: #4caf50;
      --warning: #ffb300;
      --bg: #141416;
      --bg2: #1c1c1f;
      --surface: #222226;
      --surface2: #2a2a2e;
      --border: #38383f;
      --text: #f0e6ff;
      --text-muted: #9370b8;
      --radius: 12px;
      --shadow: 0 2px 20px rgba(0,0,0,0.45);
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Noto Sans JP', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
    header {
      background: var(--bg2);
      color: #fff;
      padding: 14px 18px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      align-items: center;
      gap: 10px;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 12px rgba(0,0,0,0.4);
    }
    .header-title {
      grid-column: 1 / -1;
      text-align: center;
      font-size: 2.55rem;
      font-weight: 800;
      letter-spacing: 0.06em;
      background: linear-gradient(135deg, #ff9a00, #ff6a00, #ff4e00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
      padding: 4px 0;
    }
    .header-row {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-count {
      background: rgba(192,132,252,0.15);
      border: 1px solid rgba(192,132,252,0.35);
      border-radius: 20px;
      padding: 4px 12px;
      font-size: 0.9rem;
      color: var(--primary);
      font-weight: 600;
    }
    .btn-add-header {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #f7971e, #ff4e50);
      color: #fff;
      border: none;
      border-radius: 22px;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(255,78,80,0.35);
      transition: transform 0.15s, box-shadow 0.15s;
      white-space: nowrap;
    }
    .btn-add-header:active { transform: scale(0.96); box-shadow: none; }

    /* ===== ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ ===== */
    .toolbar {
      padding: 14px 16px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      background: var(--bg2);
      border-bottom: 1px solid var(--border);
    }
    .toolbar input[type="text"] {
      flex: 1;
      min-width: 150px;
      padding: 15px 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 1.1rem;
      outline: none;
      transition: border-color 0.2s;
      background: var(--surface);
      color: var(--text);
    }
    .toolbar input[type="text"]::placeholder { color: var(--text-muted); }
    .toolbar input[type="text"]:focus { border-color: var(--primary); }
    .toolbar select {
      padding: 15px 12px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 1.05rem;
      background: var(--surface);
      color: var(--text);
      outline: none;
    }

    /* ===== ãƒœã‚¿ãƒ³ ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.15s, transform 0.1s;
      white-space: nowrap;
    }
    .btn:active { transform: scale(0.97); }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-success { background: var(--success); color: #fff; }
    .btn-danger  { background: var(--danger); color: #fff; }
    .btn-outline {
      background: rgba(192,132,252,0.08);
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    .btn-sm { padding: 7px 12px; font-size: 0.85rem; }
    .btn-icon { padding: 7px; border-radius: 8px; }

    /* ===== ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ ===== */
    .list-container {
      padding: 14px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .person-card {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--border);
    }
    .card-header {
      padding: 14px 16px 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: 700;
      color: #fff;
      flex-shrink: 0;
    }
    .card-info { flex: 1; min-width: 0; }
    .card-name {
      font-size: 1.08rem;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .card-sub {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card-badges {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
      flex-shrink: 0;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      padding: 3px 9px;
      border-radius: 6px;
      font-size: 0.82rem;
      font-weight: 800;
      letter-spacing: 0.04em;
    }
    /* ä¿¡ç”¨åº¦ãƒãƒƒã‚¸ï¼šãƒ©ãƒ³ã‚¯æ–‡å­—ã®ã¿ãƒ»ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ */
    .trust-S { background: linear-gradient(135deg,#1b4d28,#2a6b38); color: #6ef093; border: 1px solid #3a8a4a; box-shadow: 0 0 6px rgba(110,240,147,0.2); }
    .trust-A { background: linear-gradient(135deg,#0e1e40,#1a3060); color: #6ab4fa; border: 1px solid #2a50a0; box-shadow: 0 0 6px rgba(100,180,250,0.2); }
    .trust-B { background: linear-gradient(135deg,#2e1e00,#4a3200); color: #ffd04a; border: 1px solid #6a4800; box-shadow: 0 0 6px rgba(255,200,50,0.2); }
    .trust-C { background: linear-gradient(135deg,#2e0808,#4a1010); color: #ff7a70; border: 1px solid #7a2020; box-shadow: 0 0 6px rgba(255,100,80,0.2); }
    .trust-D { background: linear-gradient(135deg,#1a1a22,#252530); color: #888899; border: 1px solid #3a3a4a; }
    /* ã‚¿ã‚¤ãƒ—ãƒãƒƒã‚¸ */
    .type-P { background: #2a0a18; color: #f48fb1; border: 1px solid #5a1a35; }
    .type-C { background: #0a1228; color: #9fa8da; border: 1px solid #1a2460; }
    .type-A { background: #001816; color: #80cbc4; border: 1px solid #003d38; }
    .type-S { background: #1c0e00; color: #ffcc80; border: 1px solid #3a2500; }

    /* ç«‹å ´ãƒãƒƒã‚¸ï¼ˆã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»çµµæ–‡å­—ãªã—ï¼‰ */
    .pos-badge {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 4px;
      font-size: 0.62rem;
      font-weight: 800;
      letter-spacing: 0.08em;
      vertical-align: middle;
    }
    .pos-up   { background: rgba(79,200,120,0.15); color: #4fc878; border: 1px solid rgba(79,200,120,0.4); }
    .pos-down { background: rgba(255,82,82,0.15);  color: #ff7070; border: 1px solid rgba(255,82,82,0.4); }
    .pos-eq   { background: rgba(150,150,200,0.15); color: #aab0cc; border: 1px solid rgba(150,150,200,0.4); }

    /* ã‚«ãƒ¼ãƒ‰è©³ç´°ï¼ˆå±•é–‹ï¼‰ */
    .card-detail {
      display: none;
      padding: 0 16px 16px;
      border-top: 1px solid var(--border);
      background: var(--surface2);
    }
    .card-detail.open { display: block; }
    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    .detail-item { }
    .detail-item.full { grid-column: 1 / -1; }
    .detail-label {
      font-size: 0.72rem;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 3px;
    }
    .detail-value {
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text);
      word-break: break-all;
    }
    .detail-value a {
      color: var(--primary);
      text-decoration: none;
    }
    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    .chevron {
      font-size: 0.85rem;
      color: var(--text-muted);
      transition: transform 0.2s;
    }
    .chevron.open { transform: rotate(180deg); }

    /* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 200;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 12px 12px 40px;
    }
    .modal-overlay.open { display: block; }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      width: 100%;
      max-width: 520px;
      padding: 20px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.6);
      margin: 0 auto;
    }
    /* ãƒ•ã‚©ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒŠå†…ã«åã‚ã‚‹ */
    #editModal .modal {
      max-height: none;
    }
    #editModal .modal form {
      overflow-y: visible;
    }
    .modal-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: var(--surface);
      z-index: 1;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-muted);
      padding: 4px 8px;
      line-height: 1;
      border-radius: 6px;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ  */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    .form-group { display: flex; flex-direction: column; gap: 6px; }
    .form-group.full { grid-column: 1 / -1; }
    label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-muted);
    }
    input, select, textarea {
      width: 100%;
      padding: 14px 15px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 1.05rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.2s;
      background: var(--bg2);
      color: var(--text);
    }
    input::placeholder { color: var(--text-muted); }
    input:focus, select:focus, textarea:focus { border-color: var(--primary); }
    textarea { resize: vertical; min-height: 80px; }
    select option { background: var(--surface); color: var(--text); }
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid var(--border);
    }

    /* ===== ç©ºçŠ¶æ…‹ ===== */
    .empty-state {
      text-align: center;
      padding: 60px 24px;
      color: var(--text-muted);
    }
    .empty-state .icon { font-size: 3rem; margin-bottom: 12px; }
    .empty-state p { font-size: 1rem; margin-top: 8px; }

    /* ===== FABéè¡¨ç¤ºï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã«çµ±ä¸€ï¼‰ ===== */
    .fab { display: none; }

    /* ===== ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆæ¡ä»¶â‘ ï¼‰ ===== */
    .card-highlight1 {
      border: 1.5px solid rgba(100,200,255,0.5) !important;
      box-shadow: 0 0 12px rgba(100,200,255,0.15), var(--shadow) !important;
      animation: glow1 2.5s ease-in-out infinite;
    }
    @keyframes glow1 {
      0%,100% { box-shadow: 0 0 8px rgba(100,200,255,0.15), var(--shadow); }
      50%      { box-shadow: 0 0 18px rgba(100,200,255,0.35), var(--shadow); }
    }

    /* ===== ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚«ãƒ¼ãƒ‰ï¼ˆæ¡ä»¶â‘¡ï¼šã•ã‚‰ã«å…‰ã‚‹ï¼‰ ===== */
    .card-highlight2 {
      border: 1.5px solid rgba(255,165,0,0.7) !important;
      box-shadow: 0 0 16px rgba(255,140,0,0.3), var(--shadow) !important;
      animation: glow2 1.8s ease-in-out infinite;
    }
    @keyframes glow2 {
      0%,100% { box-shadow: 0 0 10px rgba(255,140,0,0.25), var(--shadow); }
      50%      { box-shadow: 0 0 26px rgba(255,140,0,0.55), 0 0 6px rgba(255,200,0,0.3), var(--shadow); }
    }

    /* ===== æœ€çµ‚é€£çµ¡æ—¥ãƒãƒƒã‚¸ ===== */
    .lc-badge {
      display: inline-block;
      padding: 2px 9px;
      border-radius: 5px;
      font-size: 0.82rem;
      font-weight: 700;
    }
    .lc-fresh  { background: rgba(76,175,80,0.15);  color: #69f08a; border: 1px solid rgba(76,175,80,0.4); }
    .lc-recent { background: rgba(79,142,247,0.15); color: #7eb8ff; border: 1px solid rgba(79,142,247,0.4); }
    .lc-mid    { background: rgba(255,179,0,0.15);  color: #ffd04a; border: 1px solid rgba(255,179,0,0.4); }
    .lc-old    { background: rgba(255,82,82,0.15);  color: #ff8a80; border: 1px solid rgba(255,82,82,0.4); }
    .lc-dead   { background: rgba(100,100,120,0.15);color: #888899; border: 1px solid rgba(100,100,120,0.4); }

    /* ===== å…±æœ‰ãƒ‘ãƒãƒ« ===== */
    .share-section { padding: 4px 0; }
    .share-section-title {
      font-size: 0.92rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 6px;
      letter-spacing: 0.02em;
    }
    .share-desc {
      font-size: 0.82rem;
      color: var(--text-muted);
      line-height: 1.55;
      margin-bottom: 4px;
    }
    .share-divider {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }
    .share-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    /* ===== Toast ===== */
    .toast {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 12px 22px;
      border-radius: 24px;
      font-size: 0.95rem;
      z-index: 300;
      opacity: 0;
      transition: opacity 0.25s, transform 0.25s;
      white-space: nowrap;
      pointer-events: none;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* ===== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– ===== */
    @media (max-width: 480px) {
      .form-grid { grid-template-columns: 1fr; }
      .detail-grid { grid-template-columns: 1fr; }
      .form-group.full { grid-column: 1; }
      .modal-overlay { padding: 8px 8px 60px; }
      .modal { padding: 16px; }
    }
  </style>
</head>
<body>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<header>
  <div class="header-title">Hot List</div>
  <div class="header-row">
    <span class="header-count" id="countBadge">0äºº</span>
    <button class="btn-add-header" onclick="openAddModal()">ï¼‹ è¿½åŠ </button>
  </div>
</header>

<!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
<div class="toolbar">
  <input type="text" id="searchInput" placeholder="åå‰ãƒ»ä»•äº‹ãƒ»é–¢ä¿‚æ€§ã§æ¤œç´¢" oninput="renderList()">
  <select id="filterTrust" onchange="renderList()">
    <option value="">ä¿¡ç”¨åº¦ å…¨ã¦</option>
    <option value="S">S ãƒ©ãƒ³ã‚¯</option>
    <option value="A">A ãƒ©ãƒ³ã‚¯</option>
    <option value="B">B ãƒ©ãƒ³ã‚¯</option>
    <option value="C">C ãƒ©ãƒ³ã‚¯</option>
    <option value="D">D ãƒ©ãƒ³ã‚¯</option>
  </select>
  <select id="filterType" onchange="renderList()">
    <option value="">ã‚¿ã‚¤ãƒ— å…¨ã¦</option>
    <option value="ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚¿ãƒ¼">ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚¿ãƒ¼</option>
    <option value="ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼</option>
    <option value="ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼">ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</option>
    <option value="ã‚µãƒãƒ¼ã‚¿ãƒ¼">ã‚µãƒãƒ¼ã‚¿ãƒ¼</option>
  </select>
  <button class="btn btn-outline btn-sm" onclick="openShareModal()">å…±æœ‰</button>
</div>

<!-- ãƒªã‚¹ãƒˆ -->
<div class="list-container" id="listContainer"></div>

<!-- FABï¼ˆéè¡¨ç¤ºï¼‰ -->
<button class="fab" onclick="openAddModal()" title="è¿½åŠ ">ï¼‹</button>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- ===== è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <div class="modal-title">
      <span id="modalTitle">æ–°è¦è¿½åŠ </span>
      <button class="modal-close" onclick="closeEditModal()">âœ•</button>
    </div>
    <form id="personForm" onsubmit="savePerson(event)">
      <div class="form-grid">

        <div class="form-group full">
          <label>åå‰ *</label>
          <input type="text" id="f_name" required placeholder="ä¾‹ï¼šç”°ä¸­ å¤ªéƒ">
        </div>

        <div class="form-group">
          <label>å¹´é½¢</label>
          <select id="f_age">
            <option value="">-</option>
            <option value="18">18æ­³</option>
            <option value="19">19æ­³</option>
            <option value="20">20æ­³</option>
            <option value="21">21æ­³</option>
            <option value="22">22æ­³</option>
            <option value="23">23æ­³</option>
            <option value="24" selected>24æ­³</option>
            <option value="25">25æ­³</option>
            <option value="26">26æ­³</option>
            <option value="27">27æ­³</option>
            <option value="28">28æ­³</option>
            <option value="29">29æ­³</option>
            <option value="30">30æ­³</option>
            <option value="31">31æ­³</option>
            <option value="32">32æ­³</option>
            <option value="33">33æ­³</option>
            <option value="34">34æ­³</option>
            <option value="35">35æ­³</option>
            <option value="36">36æ­³</option>
            <option value="37">37æ­³</option>
            <option value="38">38æ­³</option>
            <option value="39">39æ­³</option>
            <option value="40">40æ­³</option>
            <option value="41">41æ­³</option>
            <option value="42">42æ­³</option>
            <option value="43">43æ­³</option>
            <option value="44">44æ­³</option>
            <option value="45">45æ­³</option>
            <option value="46">46æ­³</option>
            <option value="47">47æ­³</option>
            <option value="48">48æ­³</option>
            <option value="49">49æ­³</option>
            <option value="50">50æ­³</option>
          </select>
        </div>

        <div class="form-group">
          <label>æ€§åˆ¥</label>
          <select id="f_gender">
            <option value="">-</option>
            <option value="ç”·æ€§">ç”·æ€§</option>
            <option value="å¥³æ€§">å¥³æ€§</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
        </div>

        <div class="form-group full">
          <label>ã‚¤ãƒ³ã‚¹ã‚¿ URL</label>
          <input type="url" id="f_insta" placeholder="https://www.instagram.com/...">
        </div>

        <div class="form-group full">
          <label>é–¢ä¿‚æ€§</label>
          <input type="text" id="f_relation" placeholder="ä¾‹ï¼šä¸­å­¦ã®é‡çƒéƒ¨ã®åŒç´šç”Ÿ">
        </div>

        <div class="form-group full">
          <label>ä»•äº‹ï¼ˆç¤¾åï¼‰</label>
          <input type="text" id="f_job" placeholder="ä¾‹ï¼šå–¶æ¥­ / æ ªå¼ä¼šç¤¾ã€‡ã€‡">
        </div>

        <div class="form-group">
          <label>ä¿¡ç”¨åº¦</label>
          <select id="f_trust">
            <option value="">-</option>
            <option value="S">Sï¼ˆ100%ï¼‰</option>
            <option value="A">Aï¼ˆ80%ä»¥ä¸Šï¼‰</option>
            <option value="B">Bï¼ˆ50%ä»¥ä¸Šï¼‰</option>
            <option value="C">Cï¼ˆãã‚Œä»¥ä¸‹ï¼‰</option>
            <option value="D">Dï¼ˆå…¨ããªã—ï¼‰</option>
          </select>
        </div>

        <div class="form-group">
          <label>ç«‹å ´</label>
          <select id="f_position">
            <option value="">-</option>
            <option value="â†‘">â†‘ è‡ªåˆ†ãŒä¸Š</option>
            <option value="â†“">â†“ è‡ªåˆ†ãŒä¸‹</option>
            <option value="ãƒ¼">ãƒ¼ åŒã˜</option>
          </select>
        </div>

        <div class="form-group full">
          <label>ãƒ‹ãƒ¼ã‚º</label>
          <input type="text" id="f_needs" placeholder="ä¾‹ï¼šãŠé‡‘ã‚’ç¨¼ããŸã„ã€ä»•äº‹ã‚’è¾ã‚ãŸã„">
        </div>

        <div class="form-group">
          <label>ç¾ä½æ‰€ï¼ˆéƒ½é“åºœçœŒï¼‰</label>
          <input type="text" id="f_address" placeholder="ä¾‹ï¼šç¦å²¡" value="ç¦å²¡">
        </div>

        <div class="form-group">
          <label>ç¾ä½æ‰€ï¼ˆå¸‚ï¼‰</label>
          <input type="text" id="f_address_city" placeholder="ä¾‹ï¼šç¦å²¡å¸‚">
        </div>

        <div class="form-group">
          <label>å‡ºèº«åœ°ï¼ˆéƒ½é“åºœçœŒï¼‰</label>
          <input type="text" id="f_hometown" placeholder="ä¾‹ï¼šç¦å²¡" value="ç¦å²¡">
        </div>

        <div class="form-group">
          <label>å‡ºèº«åœ°ï¼ˆå¸‚ï¼‰</label>
          <input type="text" id="f_hometown_city" placeholder="ä¾‹ï¼šç­‘ç´«é‡å¸‚">
        </div>

        <div class="form-group">
          <label>ä½ã¾ã„</label>
          <select id="f_living">
            <option value="">-</option>
            <option value="ä¸€äººæš®ã‚‰ã—">ä¸€äººæš®ã‚‰ã—</option>
            <option value="å®Ÿå®¶">å®Ÿå®¶</option>
            <option value="åŒæ£²">åŒæ£²</option>
            <option value="åŠåŒæ£²">åŠåŒæ£²</option>
            <option value="ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹">ã‚·ã‚§ã‚¢ãƒã‚¦ã‚¹</option>
          </select>
        </div>

        <div class="form-group">
          <label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</label>
          <select id="f_partner">
            <option value="">-</option>
            <option value="æœ‰ã‚Š">æœ‰ã‚Š</option>
            <option value="ç„¡ã—">ç„¡ã—</option>
            <option value="çµå©š">çµå©š</option>
            <option value="å­ä¾›ã‚ã‚Š">å­ä¾›ã‚ã‚Š</option>
          </select>
        </div>

        <div class="form-group full">
          <label>ï¼”ã¤ã®ã‚¿ã‚¤ãƒ—</label>
          <select id="f_type">
            <option value="">-</option>
            <option value="ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚¿ãƒ¼">ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚¿ãƒ¼</option>
            <option value="ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼">ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼</option>
            <option value="ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼">ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼</option>
            <option value="ã‚µãƒãƒ¼ã‚¿ãƒ¼">ã‚µãƒãƒ¼ã‚¿ãƒ¼</option>
          </select>
        </div>

        <div class="form-group full">
          <label>æœ€çµ‚é€£çµ¡æ—¥</label>
          <select id="f_lastcontact">
            <option value="">-</option>
            <option value="1é€±é–“ä»¥å†…">1é€±é–“ä»¥å†…</option>
            <option value="1ãƒ¶æœˆä»¥å†…">1ãƒ¶æœˆä»¥å†…</option>
            <option value="3ãƒ¶æœˆä»¥å†…">3ãƒ¶æœˆä»¥å†…</option>
            <option value="åŠå¹´ä»¥å†…">åŠå¹´ä»¥å†…</option>
            <option value="1å¹´ä»¥å†…">1å¹´ä»¥å†…</option>
            <option value="3å¹´ä»¥ä¸Šå‰">3å¹´ä»¥ä¸Šå‰</option>
          </select>
        </div>

        <div class="form-group full">
          <label>å‚™è€ƒ</label>
          <textarea id="f_memo" placeholder="è‡ªç”±è¨˜è¿°"></textarea>
        </div>

      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-outline" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button type="submit" class="btn btn-primary">ä¿å­˜</button>
      </div>
    </form>
  </div>
</div>

<!-- ===== å…±æœ‰ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal-overlay" id="shareModal">
  <div class="modal">
    <div class="modal-title">
      <span>å…±æœ‰ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</span>
      <button class="modal-close" onclick="closeShareModal()">âœ•</button>
    </div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³â‘ ï¼šURLã‚’å…±æœ‰ -->
    <div class="share-section">
      <div class="share-section-title">ã‚¢ãƒ—ãƒªã®URLã‚’å…±æœ‰</div>
      <p class="share-desc">ãƒ¡ãƒ³ãƒãƒ¼ã«ã“ã®ã‚¢ãƒ—ãƒªã®URLã‚’é€ã‚Šã¾ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ã¯å„è‡ªã®ç«¯æœ«ã«ä¿å­˜ï¼‰</p>
      <div class="share-actions">
        <button class="btn btn-primary" onclick="shareUrl()">URLã‚’å…±æœ‰ãƒ»ã‚³ãƒ”ãƒ¼</button>
      </div>
      <div id="shareUrlDisplay" style="margin-top:10px;"></div>
    </div>

    <div class="share-divider"></div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³â‘¡ï¼šãƒ‡ãƒ¼ã‚¿å…±æœ‰ï¼ˆJSONï¼‰ -->
    <div class="share-section">
      <div class="share-section-title">ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ï¼ˆJSONï¼‰</div>
      <p class="share-desc">ãƒ‡ãƒ¼ã‚¿ã‚’JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦LINEã‚„ãƒ¡ãƒ¼ãƒ«ã§é€ä»˜ã€‚å—ã‘å–ã£ãŸå´ã¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§å–ã‚Šè¾¼ã¿å¯èƒ½ã€‚</p>
      <div class="share-actions">
        <button class="btn btn-outline" onclick="exportData()">JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <label class="btn btn-outline" style="cursor:pointer;">
          JSONã‚¤ãƒ³ãƒãƒ¼ãƒˆ
          <input type="file" accept=".json" style="display:none" onchange="importData(event)">
        </label>
      </div>
    </div>

    <div class="share-divider"></div>

    <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³â‘¢ï¼šGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ -->
    <div class="share-section">
      <div class="share-section-title">Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
      <p class="share-desc">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLï¼ˆGAS Webã‚¢ãƒ—ãƒªURLï¼‰ã‚’è¨­å®šã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã¾ã™ã€‚</p>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
        <input type="url" id="gasUrlInput" placeholder="https://script.google.com/macros/s/..." style="font-size:0.88rem;padding:10px 12px;">
        <div style="display:flex;gap:8px;">
          <button class="btn btn-primary" onclick="saveToSheet()">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«é€ä¿¡</button>
          <button class="btn btn-outline btn-sm" onclick="saveGasUrl()">URLä¿å­˜</button>
        </div>
        <p class="share-desc" style="margin-top:4px;">â€» è¨­å®šæ–¹æ³•ã¯ä¸‹ã®æ‰‹é †ã‚’å‚ç…§ã—ã¦ãã ã•ã„</p>
        <details style="margin-top:4px;">
          <summary style="font-size:0.82rem;color:var(--text-muted);cursor:pointer;">Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨­å®šæ‰‹é †ã‚’è¦‹ã‚‹</summary>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:8px;line-height:1.7;background:var(--bg2);padding:10px;border-radius:8px;">
            1. Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ–°è¦ä½œæˆ<br>
            2. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€â†’ã€ŒApps Scriptã€ã‚’é–‹ã<br>
            3. ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜<br>
            4. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ç¨®é¡ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€<br>
            5. ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã€Œå…¨å“¡ã€ã«è¨­å®šã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤<br>
            6. è¡¨ç¤ºã•ã‚ŒãŸURLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ã€ŒURLä¿å­˜ã€
            <div style="margin-top:8px;">
              <button class="btn btn-outline btn-sm" onclick="copyGasCode()">GASã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
            </div>
          </div>
        </details>
      </div>
    </div>

    <div class="share-divider"></div>

    <div class="share-section">
      <div id="shareStats" style="font-size:0.83rem;color:var(--text-muted);"></div>
      <button class="btn btn-danger btn-sm" style="margin-top:10px;" onclick="clearAll()">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
    </div>
  </div>
</div>

<!-- ===== å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal">
    <div class="modal-title">å‰Šé™¤ã®ç¢ºèª</div>
    <p id="deleteConfirmText" style="font-size:0.9rem;margin-bottom:16px;"></p>
    <div class="form-actions">
      <button class="btn btn-outline" onclick="closeDeleteModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-danger" onclick="confirmDelete()">å‰Šé™¤ã™ã‚‹</button>
    </div>
  </div>
</div>

<script>
// ===== ãƒ‡ãƒ¼ã‚¿ç®¡ç† =====
let people = JSON.parse(localStorage.getItem('hotlist_v1') || '[]');
let editingId = null;
let deleteTargetId = null;

function save() {
  localStorage.setItem('hotlist_v1', JSON.stringify(people));
}

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2);
}

// ===== ã‚«ãƒ©ãƒ¼ï¼ˆã‚¢ãƒã‚¿ãƒ¼ç”¨ï¼šæ€§åˆ¥å¯¾å¿œï¼‰ =====
const COLORS_MALE   = ['#0097a7','#00838f','#006064','#00acc1','#26c6da','#00bcd4','#0288d1','#0277bd'];
const COLORS_FEMALE = ['#e91e8c','#c2185b','#ad1457','#f06292','#ec407a','#e91e63','#d81b60','#f48fb1'];
const COLORS_OTHER  = ['#8e24aa','#7b1fa2','#6a1b9a','#9c27b0','#ab47bc','#7e57c2','#5e35b1','#4527a0'];
function getColor(name, gender) {
  let h = 0;
  for (let c of (name || 'A')) h = (h * 31 + c.charCodeAt(0)) & 0xff;
  if (gender === 'å¥³æ€§') return COLORS_FEMALE[h % COLORS_FEMALE.length];
  if (gender === 'ç”·æ€§') return COLORS_MALE[h % COLORS_MALE.length];
  return COLORS_OTHER[h % COLORS_OTHER.length];
}

// ===== ã‚¿ã‚¤ãƒ—ç•¥ç§° =====
const TYPE_SHORT = { 'ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚¿ãƒ¼': 'P', 'ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼': 'C', 'ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼': 'A', 'ã‚µãƒãƒ¼ã‚¿ãƒ¼': 'S' };

// ===== ç«‹å ´è¡¨ç¤º =====
function positionLabel(p) {
  if (p === 'â†‘') return '<span class="pos-badge pos-up">â†‘</span>';
  if (p === 'â†“') return '<span class="pos-badge pos-down">â†“</span>';
  if (p === 'ãƒ¼') return '<span class="pos-badge pos-eq">ãƒ¼</span>';
  return '';
}

// ===== æœ€çµ‚é€£çµ¡æ—¥ã‚¯ãƒ©ã‚¹åˆ¤å®š =====
function lastcontactClass(v) {
  if (v === '1é€±é–“ä»¥å†…') return 'fresh';
  if (v === '1ãƒ¶æœˆä»¥å†…') return 'recent';
  if (v === '3ãƒ¶æœˆä»¥å†…' || v === 'åŠå¹´ä»¥å†…') return 'mid';
  if (v === '1å¹´ä»¥å†…') return 'old';
  return 'dead'; // 3å¹´ä»¥ä¸Šå‰
}

// ===== ãƒã‚¤ãƒ©ã‚¤ãƒˆåˆ¤å®š =====
function getHighlightClass(p) {
  const age = parseInt(p.age, 10);
  const ageOk = !isNaN(age) && age >= 20 && age <= 26;
  const livingOk = p.living === 'ä¸€äººæš®ã‚‰ã—';
  const addressOk = (p.address || '').includes('ç¦å²¡');
  const hometownOk = (p.hometown || '').includes('ç¦å²¡');
  if (!ageOk || !livingOk || !addressOk || !hometownOk) return '';
  // æ¡ä»¶â‘¡ï¼šã•ã‚‰ã«ä¿¡ç”¨åº¦S/A ã‹ã¤ ç«‹å ´â†‘
  if ((p.trust === 'S' || p.trust === 'A') && p.position === 'â†‘') return 'card-highlight2';
  // æ¡ä»¶â‘ 
  return 'card-highlight1';
}

// ===== ãƒªã‚¹ãƒˆæç”» =====
function renderList() {
  const q = document.getElementById('searchInput').value.toLowerCase();
  const ft = document.getElementById('filterTrust').value;
  const ftp = document.getElementById('filterType').value;

  const filtered = people.filter(p => {
    const matchQ = !q || [p.name, p.job, p.relation, p.needs, p.address, p.address_city, p.hometown, p.hometown_city, p.memo]
      .some(v => (v||'').toLowerCase().includes(q));
    const matchT = !ft || p.trust === ft;
    const matchTP = !ftp || p.type === ftp;
    return matchQ && matchT && matchTP;
  });

  document.getElementById('countBadge').textContent = `${filtered.length}äºº`;
  const container = document.getElementById('listContainer');

  if (filtered.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="icon">ğŸ“‹</div>
        <strong>${people.length === 0 ? 'ã¾ã ç™»éŒ²ãŒã‚ã‚Šã¾ã›ã‚“' : 'è©²å½“è€…ãªã—'}</strong>
        <p>${people.length === 0 ? 'å³ä¸Šã®ã€Œï¼‹ è¿½åŠ ã€ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„' : 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚„æ¤œç´¢æ¡ä»¶ã‚’å¤‰ãˆã¦ã¿ã¦ãã ã•ã„'}</p>
      </div>`;
    return;
  }

  container.innerHTML = filtered.map(p => {
    const initial = (p.name||'?')[0];
    const color = getColor(p.name, p.gender);
    const typeShort = TYPE_SHORT[p.type] || '';
    const typeCls = typeShort ? `type-${typeShort}` : '';
    const hlClass = getHighlightClass(p);
    const addressFull = [p.address, p.address_city].filter(Boolean).join(' ');
    const hometownFull = [p.hometown, p.hometown_city].filter(Boolean).join(' ');
    return `
    <div class="person-card ${hlClass}" id="card-${p.id}">
      <div class="card-header" onclick="toggleCard('${p.id}')">
        <div class="avatar" style="background:${color}">${initial}</div>
        <div class="card-info">
          <div class="card-name">
            ${escHtml(p.name)}
            ${p.position ? `<span class="position-badge">${positionLabel(p.position)}</span>` : ''}
          </div>
          <div class="card-sub">${[p.age ? p.age+'æ­³' : '', p.gender, p.job].filter(Boolean).join(' Â· ')}</div>
          <div class="card-sub">${p.relation || ''}</div>
        </div>
        <div class="card-badges">
          ${p.trust ? `<span class="badge trust-${p.trust}">${p.trust}</span>` : ''}
          ${typeShort ? `<span class="badge ${typeCls}">${p.type}</span>` : ''}
          <span class="chevron" id="chev-${p.id}">â–¼</span>
        </div>
      </div>
      <div class="card-detail" id="detail-${p.id}">
        <div class="detail-grid">
          ${p.needs ? detailItem('ãƒ‹ãƒ¼ã‚º', escHtml(p.needs)) : ''}
          ${addressFull ? detailItem('ç¾ä½æ‰€', escHtml(addressFull)) : ''}
          ${hometownFull ? detailItem('å‡ºèº«åœ°', escHtml(hometownFull)) : ''}
          ${p.living ? detailItem('ä½ã¾ã„', escHtml(p.living)) : ''}
          ${p.partner ? detailItem('ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼', escHtml(p.partner)) : ''}
          ${p.lastcontact ? detailItem('æœ€çµ‚é€£çµ¡', `<span class="lc-badge lc-${lastcontactClass(p.lastcontact)}">${escHtml(p.lastcontact)}</span>`) : ''}
          ${p.insta ? `<div class="detail-item"><div class="detail-label">ã‚¤ãƒ³ã‚¹ã‚¿</div><div class="detail-value"><a href="${escHtml(p.insta)}" target="_blank" rel="noopener">Instagram</a></div></div>` : ''}
          ${p.memo ? `<div class="detail-item full">${detailItemRaw('å‚™è€ƒ', escHtml(p.memo))}</div>` : ''}
        </div>
        <div class="card-actions">
          <button class="btn btn-outline btn-sm" onclick="openEditModal('${p.id}')">ç·¨é›†</button>
          <button class="btn btn-danger btn-sm" onclick="askDelete('${p.id}')">å‰Šé™¤</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function detailItem(label, value) {
  return `<div class="detail-item"><div class="detail-label">${label}</div><div class="detail-value">${value}</div></div>`;
}
function detailItemRaw(label, value) {
  return `<div class="detail-label">${label}</div><div class="detail-value">${value}</div>`;
}

function toggleCard(id) {
  const detail = document.getElementById('detail-' + id);
  const chev   = document.getElementById('chev-' + id);
  detail.classList.toggle('open');
  chev.classList.toggle('open');
}

function escHtml(s) {
  return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ===== ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾© =====
const FIELDS = ['name','age','gender','insta','relation','job','trust','position','needs',
                'address','address_city','hometown','hometown_city','living','partner','type','lastcontact','memo'];

// ===== ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ =====
function openAddModal() {
  editingId = null;
  document.getElementById('modalTitle').textContent = 'æ–°è¦è¿½åŠ ';
  document.getElementById('personForm').reset();
  // åˆæœŸå€¤ã‚’è¨­å®šï¼ˆresetå¾Œã«ä¸Šæ›¸ãï¼‰
  document.getElementById('f_age').value = '24';
  document.getElementById('f_address').value = 'ç¦å²¡';
  document.getElementById('f_address_city').value = '';
  document.getElementById('f_hometown').value = 'ç¦å²¡';
  document.getElementById('f_hometown_city').value = '';
  document.getElementById('editModal').classList.add('open');
  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å…ˆé ­ã«æˆ»ã™
  setTimeout(() => { document.getElementById('editModal').scrollTop = 0; }, 0);
}

function openEditModal(id) {
  const p = people.find(x => x.id === id);
  if (!p) return;
  editingId = id;
  document.getElementById('modalTitle').textContent = 'ç·¨é›†ï¼š' + p.name;
  FIELDS.forEach(f => {
    const el = document.getElementById('f_' + f);
    if (el) el.value = p[f] || '';
  });
  document.getElementById('editModal').classList.add('open');
  setTimeout(() => { document.getElementById('editModal').scrollTop = 0; }, 0);
}

function closeEditModal() {
  document.getElementById('editModal').classList.remove('open');
}

function savePerson(e) {
  e.preventDefault();
  const data = {};
  FIELDS.forEach(f => {
    const el = document.getElementById('f_' + f);
    data[f] = el ? el.value.trim() : '';
  });

  if (editingId) {
    const idx = people.findIndex(x => x.id === editingId);
    if (idx !== -1) people[idx] = { ...people[idx], ...data };
  } else {
    data.id = generateId();
    data.createdAt = new Date().toISOString();
    people.unshift(data);
  }
  save();
  closeEditModal();
  renderList();
  showToast(editingId ? 'æ›´æ–°ã—ã¾ã—ãŸ' : 'è¿½åŠ ã—ã¾ã—ãŸ');
}

// ===== å‰Šé™¤ =====
function askDelete(id) {
  const p = people.find(x => x.id === id);
  if (!p) return;
  deleteTargetId = id;
  document.getElementById('deleteConfirmText').textContent = `ã€Œ${p.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`;
  document.getElementById('deleteModal').classList.add('open');
}
function closeDeleteModal() {
  document.getElementById('deleteModal').classList.remove('open');
  deleteTargetId = null;
}
function confirmDelete() {
  if (!deleteTargetId) return;
  people = people.filter(x => x.id !== deleteTargetId);
  save();
  renderList();
  closeDeleteModal();
  showToast('å‰Šé™¤ã—ã¾ã—ãŸ');
}

// ===== å…±æœ‰ =====
function openShareModal() {
  const stats = document.getElementById('shareStats');
  const s = people.length;
  const trust = ['S','A','B','C','D'].map(t => {
    const n = people.filter(p => p.trust === t).length;
    return n > 0 ? `${t}:${n}äºº` : null;
  }).filter(Boolean).join('ã€€');
  stats.textContent = `ç™»éŒ²æ•°ï¼š${s}äººã€€${trust ? 'ä¿¡ç”¨åº¦ â†’ ' + trust : ''}`;
  // ä¿å­˜æ¸ˆã¿GAS URLã‚’å¾©å…ƒ
  const savedGasUrl = localStorage.getItem('hotlist_gasUrl') || '';
  document.getElementById('gasUrlInput').value = savedGasUrl;
  document.getElementById('shareModal').classList.add('open');
  setTimeout(() => { document.getElementById('shareModal').scrollTop = 0; }, 0);
}
function closeShareModal() {
  document.getElementById('shareModal').classList.remove('open');
}

// URLã‚’å…±æœ‰ï¼ˆiPhone: ãƒã‚¤ãƒ†ã‚£ãƒ–å…±æœ‰ã‚·ãƒ¼ãƒˆ / PC: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ï¼‰
async function shareUrl() {
  const url = location.href;
  const display = document.getElementById('shareUrlDisplay');
  // URLè¡¨ç¤ºã‚¨ãƒªã‚¢ã«è¡¨ç¤º
  display.innerHTML = `<div style="font-size:0.8rem;color:var(--text-muted);word-break:break-all;background:var(--bg2);padding:8px 10px;border-radius:8px;border:1px solid var(--border);margin-top:4px;">${url}</div>`;
  try {
    if (navigator.share) {
      await navigator.share({ title: 'Hot List', url });
      showToast('å…±æœ‰ã—ã¾ã—ãŸ');
      return;
    }
  } catch(e) { /* ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ç„¡è¦– */ }
  // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
  try {
    await navigator.clipboard.writeText(url);
    showToast('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
    return;
  } catch(e) {}
  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  const ta = document.createElement('textarea');
  ta.value = url;
  ta.style.position = 'fixed'; ta.style.opacity = '0';
  document.body.appendChild(ta);
  ta.focus(); ta.select();
  try { document.execCommand('copy'); showToast('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); } catch(e) {}
  document.body.removeChild(ta);
}

// GAS URLä¿å­˜
function saveGasUrl() {
  const url = document.getElementById('gasUrlInput').value.trim();
  if (!url) { showToast('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  localStorage.setItem('hotlist_gasUrl', url);
  showToast('GAS URLã‚’ä¿å­˜ã—ã¾ã—ãŸ');
}

// Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸é€ä¿¡
async function saveToSheet() {
  const gasUrl = document.getElementById('gasUrlInput').value.trim()
                 || localStorage.getItem('hotlist_gasUrl') || '';
  if (!gasUrl) { showToast('GAS URLã‚’è¨­å®šã—ã¦ãã ã•ã„'); return; }
  showToast('é€ä¿¡ä¸­...');
  try {
    const resp = await fetch(gasUrl, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ data: people, exportedAt: new Date().toISOString() })
    });
    showToast('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«é€ä¿¡ã—ã¾ã—ãŸ');
  } catch(e) {
    showToast('é€ä¿¡å¤±æ•—ï¼šGAS URLã‚’ç¢ºèªã—ã¦ãã ã•ã„');
  }
}

// GASã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
function copyGasCode() {
  const code = `function doPost(e) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const json = JSON.parse(e.postData.contents);
  const people = json.data;
  const headers = ['name','age','gender','insta','relation','job','trust','position',
    'needs','address','address_city','hometown','hometown_city',
    'living','partner','type','lastcontact','memo','id','createdAt'];
  if (sheet.getLastRow() === 0) sheet.appendRow(headers);
  people.forEach(p => {
    sheet.appendRow(headers.map(h => p[h] || ''));
  });
  return ContentService.createTextOutput('ok');
}`;
  const ta = document.createElement('textarea');
  ta.value = code;
  ta.style.position = 'fixed'; ta.style.opacity = '0';
  document.body.appendChild(ta);
  ta.focus(); ta.select();
  try { document.execCommand('copy'); showToast('GASã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); } catch(e) {}
  document.body.removeChild(ta);
  try { navigator.clipboard.writeText(code).then(() => showToast('GASã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')); } catch(e) {}
}

function exportData() {
  const blob = new Blob([JSON.stringify(people, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const d = new Date();
  a.download = `hotlist_${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}.json`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
}

function importData(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const imported = JSON.parse(ev.target.result);
      if (!Array.isArray(imported)) throw new Error('å½¢å¼ã‚¨ãƒ©ãƒ¼');
      // é‡è¤‡IDã‚’é™¤ã„ã¦è¿½åŠ 
      const existingIds = new Set(people.map(p => p.id));
      const toAdd = imported.filter(p => p.id && !existingIds.has(p.id));
      people = [...toAdd, ...people];
      save();
      renderList();
      closeShareModal();
      showToast(`${toAdd.length}ä»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
    } catch {
      showToast('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—ï¼šæ­£ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„');
    }
    e.target.value = '';
  };
  reader.readAsText(file);
}

function clearAll() {
  if (!confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
  people = [];
  save();
  renderList();
  closeShareModal();
  showToast('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
}

// ===== Toast =====
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
}

// ===== ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ =====
['editModal','shareModal','deleteModal'].forEach(id => {
  document.getElementById(id).addEventListener('click', function(e) {
    if (e.target === this) {
      if (id === 'editModal') closeEditModal();
      else if (id === 'shareModal') closeShareModal();
      else if (id === 'deleteModal') closeDeleteModal();
    }
  });
});

// ===== åˆæœŸæç”» =====
// DOMãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰å®Ÿè¡Œï¼ˆiPhoneã®ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®å¯¾ç­–ï¼‰
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', renderList);
} else {
  renderList();
}

// ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‹ã‚‰å¾©å¸°ã—ãŸæ™‚ã‚‚å†æç”»ï¼ˆiPhoneã®ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ãƒ—ãƒªå¯¾ç­–ï¼‰
document.addEventListener('visibilitychange', function() {
  if (document.visibilityState === 'visible') {
    people = JSON.parse(localStorage.getItem('hotlist_v1') || '[]');
    renderList();
  }
});
</script>
</body>
</html>
